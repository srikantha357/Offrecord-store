<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Your Cart - OFF Record Store</title>

<link rel="stylesheet" href="css/style.css">

<!-- FONT AWESOME -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- RAZORPAY -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>

body{
  background:#f5f6f8;
  margin:0;
  font-family: Arial, sans-serif;
}

/* NAVBAR */
.navbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 60px;
  background:white;
  box-shadow:0 2px 10px rgba(0,0,0,0.05);
}

.logo{
  font-weight:800;
  letter-spacing:4px;
}

.navbar a{
  text-decoration:none;
  color:black;
  margin:0 10px;
}

/* TITLE */
.cart-title{
  text-align:center;
  margin-top:30px;
  font-size:32px;
}

/* LAYOUT */
.cart-wrapper{
  width:90%;
  margin:40px auto;
  display:flex;
  gap:40px;
  align-items:flex-start;
}

.cart-left{
  flex:2;
}

.cart-summary{
  flex:1;
  background:white;
  padding:25px;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,0.08);
  position:sticky;
  top:100px;
}

/* CART ITEM */
.cart-item{
  display:flex;
  gap:20px;
  background:white;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
}

.cart-item img{
  width:150px;
  height:180px;
  object-fit:cover;
  border-radius:8px;
}

.cart-item h3{
  margin:0 0 10px;
}

.qty-control{
  display:flex;
  align-items:center;
  gap:10px;
  margin-top:10px;
}

.qty-btn{
  width:28px;
  height:28px;
  border:none;
  background:black;
  color:white;
  cursor:pointer;
}

.remove-btn{
  background:none;
  border:none;
  color:red;
  cursor:pointer;
  margin-top:8px;
}

.summary-line{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}

.checkout-btn{
  width:100%;
  padding:12px;
  background:black;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:15px;
}

/* RECOMMENDED FIX */
.product-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
  gap:20px;
}

.product-card{
  background:white;
  padding:15px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
  text-align:center;
}

.product-card img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:8px;
}

.product-card button{
  margin-top:10px;
  padding:8px 15px;
  background:black;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

@media(max-width:900px){
  .cart-wrapper{
    flex-direction:column;
  }
}

</style>
</head>

<body>

<header class="navbar">
  <div class="logo">OFF RECORD STORE</div>
  <div>
    <a href="index.html">Home</a>
    <a href="index.html#shop">Shop</a>
    <a href="contact.html">Contact</a>
  </div>
  <div>
    <a href="cart.html">Cart (<span id="cart-count">0</span>)</a>
  </div>
</header>

<h1 class="cart-title">
  <i class="fas fa-shopping-cart"></i> Your Cart
</h1>

<div class="cart-wrapper">

  <div class="cart-left" id="cart-items"></div>

  <div class="cart-summary">
    <h3>Order Summary</h3>
    <div class="summary-line">
      <span>Subtotal</span>
      <span id="subtotal">â‚¹0</span>
    </div>
    <div class="summary-line">
      <span>Shipping</span>
      <span>Free</span>
    </div>
    <hr>
    <div class="summary-line" style="font-weight:bold;">
      <span>Total</span>
      <span id="total">â‚¹0</span>
    </div>

    <button class="checkout-btn" onclick="checkout()">Pay â‚¹10 (Test)</button>
  </div>

</div>

<div style="width:90%; margin:50px auto;">
  <h2>Recommended For You</h2>
  <div id="recommended-container" class="product-grid"></div>
</div>

<script src="js/products.js"></script>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];
let container = document.getElementById("cart-items");

function updateCartCount(){
  document.getElementById("cart-count").innerText = cart.length;
}

function renderCart(){
  container.innerHTML = "";
  let subtotal = 0;

  if(cart.length === 0){
    container.innerHTML = "<p>Your cart is empty.</p>";
    updateCartCount();
    return;
  }

  cart.forEach((item,index)=>{
    if(!item.qty) item.qty=1;
    subtotal += item.price * item.qty;

    container.innerHTML += `
      <div class="cart-item">
        <img src="${item.image}">
        <div>
          <h3>${item.name}</h3>
          <p>â‚¹${item.price}</p>

          <div class="qty-control">
            <button class="qty-btn" onclick="changeQty(${index},-1)">-</button>
            <span>${item.qty}</span>
            <button class="qty-btn" onclick="changeQty(${index},1)">+</button>
          </div>

          <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
        </div>
      </div>
    `;
  });

  document.getElementById("subtotal").innerText = "â‚¹"+subtotal;
  document.getElementById("total").innerText = "â‚¹"+subtotal;
  updateCartCount();
}

function changeQty(index,amount){
  cart[index].qty += amount;
  if(cart[index].qty < 1) cart[index].qty = 1;
  localStorage.setItem("cart",JSON.stringify(cart));
  renderCart();
}

function removeItem(index){
  cart.splice(index,1);
  localStorage.setItem("cart",JSON.stringify(cart));
  renderCart();
}

/* ðŸ”¥ RAZORPAY â‚¹10 TEST */
function checkout(){

  var options = {
    "key": "rzp_live_SFYyFjaypBbEo0", 
    "amount": 1000,   // â‚¹10 = 1000 paise
    "currency": "INR",
    "name": "OFF RECORD STORE",
    "description": "Test Payment",
    "handler": function (response){
        alert("Payment Successful! ID: " + response.razorpay_payment_id);
        localStorage.removeItem("cart");
        location.reload();
    },
    "theme": { "color": "#000" }
  };

  var rzp = new Razorpay(options);
  rzp.open();
}

renderCart();

/* Recommended */
const recommendedContainer = document.getElementById("recommended-container");
products.slice(0,4).forEach(p=>{
  recommendedContainer.innerHTML += `
    <div class="product-card">
      <img src="${p.image}">
      <h4>${p.name}</h4>
      <p>â‚¹${p.price}</p>
    </div>
  `;
});

</script>

</body>
</html>
